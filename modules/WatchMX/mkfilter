#!/bin/bash
OUTFILE=filter
STAMP="`date --iso=seconds`"
STATE="$1"

echo "#
# Do NOT edit this file as it is generated every time the module starts
# or is refreshed by the 'Refresh <module>' command
# It provides the 'filter' function
"

> $OUTFILE
echo 'filter() {'		>> $OUTFILE
echo ": FILTER_STATE=$STATE"	>> $OUTFILE
echo ": FILTER_DATE=$STAMP"	>> $OUTFILE
: echo "[${FUNCNAME[0]}]"	>> $OUTFILE

ALLFILTERS=`echo rules/*.rule | sort -n`
for f in $ALLFILTERS
do cat $f >> $OUTFILE
done

echo 'RULE=NO_RULE_MATCH'	 >> $OUTFILE
echo 'return 0'			 >> $OUTFILE
echo '}'			 >> $OUTFILE
